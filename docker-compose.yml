name: transendence

services:
  databank:
    build:
      context: ./backend_database
    container_name: database
    volumes:
      - ./backend_database/database:/app/data
    restart: unless-stopped
    networks:
      - transendence

  backend:
    build:
      context: ./backend_gamelogic
    container_name: game
    # env_file:
    #   - ./backend_gamelogic/.env.game
    restart: unless-stopped
    networks:
      - transendence

  frontend:
    build:
      context: ./frontend
    container_name: frontend
    restart: unless-stopped
    networks:
      - transendence

  nginx:
    image: nginx:alpine
    container_name: nginx-proxy
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./ops/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./.certs:/etc/nginx/certs:ro
    depends_on:
      - frontend
      - databank
      - backend
    restart: unless-stopped
    networks:
      - transendence

volumes:
  databank-data:

networks:
  transendence:
    driver: bridge
