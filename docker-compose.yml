name: transcendence

services:
  databank:
    build:
      context: ./backend_database
    container_name: database
    volumes:
      - ./backend_database/database:/app/data
    restart: unless-stopped
    networks:
      - transcendence

  backend:
    build:
      context: ./backend_gamelogic
    container_name: game
    # env_file:
    #   - ./backend_gamelogic/.env.game
    restart: unless-stopped
    networks:
      - transcendence

  frontend:
    build:
      context: ./frontend
    container_name: frontend
    restart: unless-stopped
    networks:
      - transcendence

  nginx:
    image: nginx:alpine
    container_name: nginx-proxy
    ports:
      - "8443:8443"
    volumes:
      - ./ops/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./.certs:/etc/nginx/certs:ro
    depends_on:
      - frontend
      - databank
      - backend
    restart: unless-stopped
    networks:
      - transcendence

  live-chat:
    build:
      context: ./live-chat
    container_name: live-chat
    environment:
      # Server config
      - PORT=${LIVECHAT_PORT:-3002}
      - HOST=${LIVECHAT_HOST:-0.0.0.0}
      - NODE_ENV=${NODE_ENV:-production}
      # Database config
      - DATABASE_PATH=${LIVECHAT_DATABASE_PATH:-/app/data/database.db}
      # Auth service URL (internal Docker network)
      - AUTH_SERVICE_URL=${AUTH_SERVICE_URL:-http://databank:3000}
      # Logging
      - LOG_LEVEL=${LOG_LEVEL:-info}
    ports:
      - "${LIVECHAT_PORT:-3002}:${LIVECHAT_PORT:-3002}"
    volumes:
      - ./live-chat/data:/app/data
    depends_on:
      - databank
    restart: unless-stopped
    networks:
      - transcendence

volumes:
  databank-data:

networks:
  transcendence:
    driver: bridge
